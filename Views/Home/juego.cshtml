@{ ViewData["Title"] = "Juego"; }

<div class="wrap">
    <h1 class="title">AhorcadORT</h1>
    <input id="palabra" type="hidden" value="@ViewBag.palabra">
    <p id="rayitas" class="word"></p>
    <input id="intentos" type="hidden" value="0">

    <div class="row">
        <input id="inputUsuario" class="input" type="text" placeholder="Elegir letra o palabra" name="eleccion">
        <div class="btns">
            <button class="btn" onclick="arriesgarLetra()">Arriesgar Letra</button>
            <button class="btn btn--alt" onclick="arriesgarPalabra()">Arriesgar Palabra</button>
        </div>
    </div>

    <form id="finJuegoForm" action='@Url.Action("FinJuego", "Home")' method="POST" encode="multipart/form-data">
        <input id="intentosHidden" name="intentos" type="hidden" value="0">
    </form>
</div>


<script>
    let palabra = document.getElementById("palabra").value;
    let letrasEncontradas = [];

    function crearTablero() {
        let salida = "";
        for (let i = 0; i < palabra.length; i++) {
            let ch = palabra[i];
            if (letrasEncontradas.Contains(ch)) {
                salida += ch + " ";
            } else {
                salida += "_ ";
            }
        }
        document.getElementById("rayitas").innerHTML = salida;
    }

    function tableroCompleto() {
        for (let i = 0; i < palabra.length; i++) {
            if (!letrasEncontradas.Contains(palabra[i])) return false;
        }
        return true;
    }

    function incrementarIntentos() {
        let intentosEl = document.getElementById("intentos");
        let intentos = parseInt(intentosEl.value);
        intentosEl.value = intentos + 1;
    }

    function limpiarInput() {
        let input = document.getElementById("inputUsuario");
        input.value = "";
    }

    crearTablero();

    function arriesgarLetra() {
        let input = document.getElementById("inputUsuario");
        let letra = input.value;
        if (!letra || letra.length !== 1) { limpiarInput(); return false; }

        let encontro = false;
        for (let i = 0; i < palabra.length; i++) {
            if (palabra[i] === letra) { encontro = true; break; }
        }

        if (encontro) {
            if (!letrasEncontradas.Contains(letra)) {
                letrasEncontradas.push(letra);
            }
        } else {
            incrementarIntentos();
        }

        crearTablero();

        if (tableroCompleto()) {
            finJuego();
        }

        limpiarInput();
        return encontro;
    }

    function arriesgarPalabra() {
        let intento = document.getElementById("inputUsuario").value;
        if (intento === palabra) {
            finJuego();
        } else {
            alert("incorrecto");
            incrementarIntentos();
        }
        limpiarInput();
    }

    function finJuego() {
        let intentosHidden = parseInt(document.getElementById("intentos").value);
        document.getElementById("intentosHidden").value = intentosHidden;
        document.getElementById("finJuegoForm").submit();
    }
</script>
